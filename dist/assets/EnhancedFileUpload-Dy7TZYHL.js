import{t as N,r as m,j as e,X as O}from"./index-CEFGCZnp.js";import{B as F}from"./button-C58ynU3B.js";import{C as Z}from"./card-DsqFjwao.js";import{I as W}from"./input-DqKHY6Ez.js";import{L as D}from"./label-C9OSIm7g.js";import{T as ee}from"./textarea-B8Ku1Xn0.js";import{B as se}from"./badge-BQVUS7r0.js";import{U as te}from"./upload-Dobc1O8K.js";import{C as ae}from"./check-DnlIeJCj.js";import{F as le}from"./user-DmvOLSi9.js";const re="/api";async function ie(a,d,s={}){const u=new FormData;u.append("file",d);const h=`${re}${a}`;try{const r=await fetch(h,{...s,method:"POST",body:u}),t=await r.json();return r.ok?{data:t}:(console.error(`Upload Error (${r.status}):`,t),N({variant:"destructive",title:"Upload Failed",description:t.message||`Upload failed with status ${r.status}`}),{error:{message:t.message||`Upload failed with status ${r.status}`,code:t.code||`${r.status}`,details:t.details||null}})}catch(r){return console.error("Upload Error:",r),N({variant:"destructive",title:"Upload Error",description:"Failed to upload file. Please try again."}),{error:{message:r.message||"An unexpected error occurred during upload",details:r}}}}const de={async upload(a,d,s){var u,h,r;if(s.allowedTypes&&s.allowedTypes.length>0){const t=a.type;if(!s.allowedTypes.some(n=>t.startsWith(n)))return{success:!1,error:`File type not allowed. Allowed types: ${s.allowedTypes.join(", ")}`}}if(s.maxSize&&a.size>s.maxSize*1024*1024)return{success:!1,error:`File size exceeds the ${s.maxSize}MB limit`};try{const t=new FormData;t.append("file",a),t.append("category",s.category),s.tags&&t.append("tags",JSON.stringify(s.tags)),s.description&&t.append("description",s.description);const n=await ie(d,a);if(n.error)return{success:!1,error:n.error.message};const T={filename:((u=n.data)==null?void 0:u.filename)||"",originalName:a.name,size:a.size,mimeType:a.type,path:((h=n.data)==null?void 0:h.url)||"",category:s.category,tags:s.tags,description:s.description,uploadDate:new Date};return{success:!0,url:(r=n.data)==null?void 0:r.url,metadata:T}}catch(t){return{success:!1,error:t.message||"Upload failed"}}},getFileExtension(a){var d;return((d=a.split(".").pop())==null?void 0:d.toLowerCase())||""},generateSafeFilename(a){const d=this.getFileExtension(a);return`${a.replace(`.${d}`,"").replace(/[^a-z0-9]/gi,"-").toLowerCase()}-${Date.now()}.${d}`}},ve=({endpoint:a,onSuccess:d,onError:s,accept:u="image/*",maxSize:h=5,maxSizeMB:r,label:t="Upload File",allowMultiple:n=!1,className:T="",category:_,allowTags:J=!1,allowDescription:K=!1,onFileSelected:$,initialPreview:X,previewType:Y})=>{const A=r||h,[o,P]=m.useState(!1),[g,b]=m.useState(X||null),[R,U]=m.useState(0),[B,v]=m.useState(null),[p,k]=m.useState(!1),[L,M]=m.useState(""),[x,z]=m.useState([]),[j,S]=m.useState(""),C=m.useRef(null),q=l=>{var y;const c=(y=l.target.files)==null?void 0:y[0];if(c){if(v(null),b(null),k(!1),$){$(c);return}if(c.type.startsWith("image/")){const w=new FileReader;w.onload=f=>{var i;return b((i=f.target)==null?void 0:i.result)},w.readAsDataURL(c)}else b("non-image")}},G=async()=>{var y,w;const l=(w=(y=C.current)==null?void 0:y.files)==null?void 0:w[0];if(!l){v("No file selected");return}P(!0),U(0);const c=setInterval(()=>{U(f=>Math.min(f+5,90))},200);try{const f=u.split(",").map(V=>V.trim()),i=await de.upload(l,a,{category:_,description:L||void 0,tags:x.length>0?x:void 0,allowedTypes:f[0]==="*/*"?void 0:f,maxSize:A});clearInterval(c),i.success?(U(100),k(!0),i.url&&i.metadata&&(d==null||d(i.url,i.metadata)),N({title:"Upload successful",description:"Your file has been uploaded successfully."})):(v(i.error||"Upload failed"),s==null||s(i.error||"Upload failed"),N({variant:"destructive",title:"Upload failed",description:i.error}))}catch(f){clearInterval(c);const i=f.message||"Upload failed";v(i),s==null||s(i),N({variant:"destructive",title:"Upload failed",description:i})}finally{P(!1)}},I=()=>{b(null),U(0),v(null),k(!1),M(""),z([]),S(""),C.current&&(C.current.value="")},E=()=>{j&&!x.includes(j)&&(z([...x,j]),S(""))},H=l=>{z(x.filter(c=>c!==l))},Q=()=>g?g==="non-image"?e.jsx("div",{className:"mt-2 bg-muted/30 rounded-md p-4 flex items-center justify-center",children:e.jsx(le,{className:"h-10 w-10 text-muted-foreground"})}):e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("img",{src:g,alt:"Preview",className:`rounded-md object-contain ${Y==="large"?"max-h-60":"max-h-40"}`}),!o&&e.jsx("button",{onClick:I,className:"absolute top-1 right-1 rounded-full bg-black/50 text-white p-1 hover:bg-black/80",children:e.jsx(O,{className:"h-4 w-4"})})]}):null;return e.jsxs("div",{className:T,children:[e.jsx(D,{htmlFor:"file-upload",children:t}),g?e.jsxs(e.Fragment,{children:[Q(),K&&e.jsxs("div",{className:"mt-4",children:[e.jsx(D,{htmlFor:"file-description",children:"Description"}),e.jsx(ee,{id:"file-description",placeholder:"Enter file description...",className:"mt-1",value:L,onChange:l=>M(l.target.value),disabled:o||p})]}),J&&e.jsxs("div",{className:"mt-4",children:[e.jsx(D,{htmlFor:"file-tags",children:"Tags"}),e.jsxs("div",{className:"flex mt-1 gap-2",children:[e.jsx(W,{id:"file-tags",placeholder:"Add tags...",value:j,onChange:l=>S(l.target.value),onKeyPress:l=>l.key==="Enter"&&E(),disabled:o||p}),e.jsx(F,{type:"button",size:"sm",onClick:E,disabled:!j||o||p,children:"Add"})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:x.map(l=>e.jsxs(se,{variant:"outline",className:"px-2 py-1",children:[l,e.jsx("button",{onClick:()=>H(l),className:"ml-1 text-muted-foreground hover:text-destructive",disabled:o||p,children:e.jsx(O,{className:"h-3 w-3"})})]},l))})]}),!$&&e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${R}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[R,"%"]})]})}),p&&e.jsxs("div",{className:"flex items-center mt-4 text-sm text-green-600",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Upload complete"]}),B&&e.jsx("div",{className:"text-sm text-destructive mt-4",children:B}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[!p&&e.jsx(F,{variant:"outline",onClick:I,disabled:o,children:"Cancel"}),!o&&!p?e.jsx(F,{onClick:G,disabled:!g,children:"Upload"}):p?e.jsx(F,{variant:"outline",onClick:I,children:"Upload Another"}):null]})]})]}):e.jsx(Z,{className:"mt-2 cursor-pointer border-dashed hover:bg-muted/30 transition-colors",children:e.jsxs("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center p-6 cursor-pointer",children:[e.jsx(te,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click or drag file to upload"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:["Maximum file size: ",A,"MB"]})]})}),e.jsx(W,{ref:C,id:"file-upload",type:"file",accept:u,multiple:n,className:"hidden",onChange:q,disabled:o})]})};export{ve as E};
