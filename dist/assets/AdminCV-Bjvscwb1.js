import{J as O,r as c,j as t}from"./index-CEFGCZnp.js";import{A as C}from"./AdminLayout-BFo7kI8c.js";import{C as v,c as V,d as S,e as y,a as U}from"./card-DsqFjwao.js";import{B as p}from"./button-C58ynU3B.js";import{D as W,b as A,c as G,d as I}from"./dialog-CF5yEXG4.js";import{S as D}from"./switch-D9dv8vKo.js";import{b as R,c as w}from"./contentService-homc20vQ.js";import{F as T}from"./user-DmvOLSi9.js";import{C as M}from"./calendar-8sjuA-jc.js";import{D as _}from"./download-DIkOb7Bk.js";import{E as z}from"./eye-BQ_UEY2C.js";import{U as H}from"./upload-Dobc1O8K.js";import"./index-CULbYOlY.js";import"./search-B6zhR9QM.js";import"./users-DLZwGyT7.js";import"./image-BSShWM4Y.js";import"./index-Cxzs49dU.js";const ce=()=>{const{toast:r}=O(),[e,m]=c.useState(null),[l,f]=c.useState(null),[d,u]=c.useState(!0),[g,h]=c.useState(null),[F,x]=c.useState(!1),[n,j]=c.useState(null);c.useEffect(()=>{(async()=>{try{u(!0);const a=await R();m((a==null?void 0:a.data)||{fileName:"Your_CV.pdf",lastUpdated:new Date().toISOString(),url:""}),f((a==null?void 0:a.settings)||{showDownloadButton:!0,showUpdateDate:!0,generateFromProfile:!1})}catch(a){h("Failed to load CV data."),console.error(a)}finally{u(!1)}})()},[]);const E=s=>{var i;const a=(i=s.target.files)==null?void 0:i[0];a&&(j(a),m(o=>({...o||{fileName:"",lastUpdated:"",url:""},fileName:a.name,lastUpdated:new Date().toISOString()})),r({title:"File Selected",description:`${a.name} is ready to be saved.`}))},k=()=>{var s;(s=document.getElementById("cv-upload-input"))==null||s.click()},L=async()=>{if(!e)return;u(!0),h(null);let s=e.url,a=e.fileName,i=e.lastUpdated;n&&(s=`/uploads/cv/${n.name}`,a=n.name,i=new Date().toISOString(),r({title:"CV Uploaded (Simulated)",description:`File ${n.name} would be uploaded.`}));const o={...e,fileName:a,lastUpdated:i,url:s};try{await w({data:o,settings:l||{showDownloadButton:!0,showUpdateDate:!0,generateFromProfile:!1}})?(m(o),j(null),r({title:"Success",description:"CV data updated successfully."})):(h("Failed to save CV data."),r({variant:"destructive",title:"Error",description:"Failed to save CV data."}))}catch(N){h("An error occurred while saving CV data."),r({variant:"destructive",title:"Error",description:"An error occurred while saving CV data."}),console.error(N)}finally{u(!1)}},P=()=>{if(e!=null&&e.url)if(e.url.startsWith("blob:")||e.url.startsWith("data:")){const s=document.createElement("a");s.href=e.url,s.download=e.fileName,document.body.appendChild(s),s.click(),document.body.removeChild(s)}else r({title:"Download (Simulated)",description:`Would download ${e.fileName} from ${e.url}`});else r({variant:"destructive",title:"No CV",description:"No CV file URL available for download."})},$=()=>{if(e!=null&&e.url&&(e.url.startsWith("blob:")||e.url.startsWith("data:")||e.url.includes(".pdf")))x(!0);else if(n){const s=URL.createObjectURL(n);m(a=>({...a,url:s})),x(!0)}else r({variant:"destructive",title:"No Preview",description:"No CV file available for preview."})},b=async(s,a)=>{const i={...l||{showDownloadButton:!0,showUpdateDate:!0,generateFromProfile:!1},[s]:a};f(i),u(!0);try{await w({data:e,settings:i})?r({title:"Settings Updated",description:`CV setting "${s}" has been ${a?"enabled":"disabled"}`}):(r({variant:"destructive",title:"Error",description:"Failed to save CV settings."}),f(l))}catch(o){r({variant:"destructive",title:"Error",description:"An error occurred while saving settings."}),f(l),console.error(o)}finally{u(!1)}},B=()=>{r({title:"Generating CV (Simulated)",description:"Creating CV from your profile data..."});const s=`Generated_CV_${Date.now()}.pdf`,a=new Date().toISOString(),i={fileName:s,lastUpdated:a,url:`/generated_cvs/${s}`};m(i),w({data:i,settings:l}),r({title:"CV Generated (Simulated)",description:"Your CV has been generated."})};return d&&!e?t.jsx(C,{title:"CV Management",children:t.jsx("p",{children:"Loading CV data..."})}):g?t.jsx(C,{title:"CV Management",children:t.jsxs("p",{children:["Error: ",g]})}):t.jsxs(C,{title:"CV Management",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs(v,{children:[t.jsxs(V,{children:[t.jsx(S,{children:"Current CV"}),t.jsx(y,{children:"Manage and update your curriculum vitae"})]}),t.jsxs(U,{className:"space-y-4",children:[t.jsxs("div",{className:"p-6 border-2 border-dashed rounded-md flex flex-col items-center justify-center text-center",children:[t.jsx(T,{className:"h-12 w-12 text-muted-foreground mb-4"}),t.jsx("p",{className:"font-medium",children:(e==null?void 0:e.fileName)||"No CV uploaded"}),(e==null?void 0:e.lastUpdated)&&t.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[t.jsx(M,{className:"h-4 w-4"})," Last updated: ",new Date(e.lastUpdated).toLocaleDateString()]}),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs(p,{variant:"outline",size:"sm",onClick:P,disabled:!(e!=null&&e.url)||d,children:[t.jsx(_,{className:"mr-2 h-4 w-4"})," Download"]}),t.jsxs(p,{variant:"outline",size:"sm",onClick:$,disabled:!(e!=null&&e.url)&&!n||d,children:[t.jsx(z,{className:"mr-2 h-4 w-4"})," Preview"]})]})]}),t.jsx("input",{type:"file",id:"cv-upload-input",accept:".pdf,.doc,.docx",onChange:E,className:"hidden"}),t.jsxs(p,{className:"w-full",onClick:k,disabled:d,children:[t.jsx(H,{className:"mr-2 h-4 w-4"})," Upload New CV File"]}),t.jsx(p,{className:"w-full mt-2",onClick:L,disabled:d||!n&&(e==null?void 0:e.url)==="",children:d?"Saving...":"Save CV Changes"})]})]}),t.jsxs(v,{children:[t.jsxs(V,{children:[t.jsx(S,{children:"CV Settings"}),t.jsx(y,{children:"Configure how your CV is displayed on the website"})]}),t.jsxs(U,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[t.jsx("span",{children:"Show CV download button on public profile"}),t.jsx(D,{checked:(l==null?void 0:l.showDownloadButton)||!1,onCheckedChange:s=>b("showDownloadButton",s),disabled:d})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[t.jsx("span",{children:"Display CV last updated date"}),t.jsx(D,{checked:(l==null?void 0:l.showUpdateDate)||!1,onCheckedChange:s=>b("showUpdateDate",s),disabled:d})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[t.jsx("span",{children:"Generate CV from profile data (Simulated)"}),t.jsx(p,{variant:"secondary",size:"sm",onClick:B,disabled:d,children:"Generate"})]})]})]})]}),t.jsx(W,{open:F,onOpenChange:x,children:t.jsxs(A,{className:"max-w-4xl h-[80vh] flex flex-col",children:[t.jsx(G,{children:t.jsxs(I,{children:["CV Preview: ",e==null?void 0:e.fileName]})}),e!=null&&e.url&&(e.url.startsWith("blob:")||e.url.startsWith("data:")||e.url.endsWith(".pdf"))?t.jsx("iframe",{src:e.url,className:"w-full h-full border rounded flex-grow",title:"CV Preview"}):t.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center flex-grow",children:t.jsx("p",{className:"text-muted-foreground",children:"Cannot preview this file type or no file URL. Please upload a PDF for preview."})})]})})]})};export{ce as default};
